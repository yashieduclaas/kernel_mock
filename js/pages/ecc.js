// ============================================================
// ecc.js — Enterprise Control Center Landing Page
// Purpose: Shows module cards grid (no sidebar)
// Dependencies: store.js, auth.js, components.js
// ============================================================

const ECCPage = (() => {
    let activeFilter = 'all';

    // Microsoft Fluent UI System Icons (24px regular) mapped by module_code
    const MODULE_ICONS = {
        AGNT_HR: `<svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 12C10.2091 12 12 10.2091 12 8C12 5.79086 10.2091 4 8 4C5.79086 4 4 5.79086 4 8C4 10.2091 5.79086 12 8 12ZM8 6C9.10457 6 10 6.89543 10 8C10 9.10457 9.10457 10 8 10C6.89543 10 6 9.10457 6 8C6 6.89543 6.89543 6 8 6ZM17 12C18.6569 12 20 10.6569 20 9C20 7.34315 18.6569 6 17 6C15.3431 6 14 7.34315 14 9C14 10.6569 15.3431 12 17 12ZM17 8C17.5523 8 18 8.44772 18 9C18 9.55228 17.5523 10 17 10C16.4477 10 16 9.55228 16 9C16 8.44772 16.4477 8 17 8ZM17 13C15.3358 13 13.8518 13.6213 12.8007 14.5856C11.8956 13.5738 10.5372 12.9999 9 13H7C4.23858 13 2 15.2386 2 18V19C2 19.5523 2.44772 20 3 20C3.55228 20 4 19.5523 4 19V18C4 16.3431 5.34315 15 7 15H9C10.1256 15 11.1643 15.5512 11.8284 16.4453C11.3516 17.1672 11.0667 18.0305 11.0067 18.9509L11 19.1111V20C11 20.5523 11.4477 21 12 21C12.5523 21 13 20.5523 13 20V19.1111C13 17.3964 14.3432 16 17 16C19.6569 16 21 17.3964 21 19.1111V20C21 20.5523 21.4477 21 22 21C22.5523 21 23 20.5523 23 20V19.1111C23 16.1836 20.7614 13 17 13Z" fill="currentColor"/></svg>`,

        AGNT_TLNT: `<svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.7578 2.50123C14.4293 2.2647 13.9887 2.24558 13.6406 2.45225L11.4063 3.77865L9.67489 2.59193C9.34261 2.36399 8.91004 2.33373 8.54895 2.51376L6.06065 3.75435C5.70021 3.9342 5.47254 4.30151 5.47254 4.70445V7.72008C5.47254 7.79498 5.47785 7.86874 5.48813 7.94092C4.00498 8.92672 3 10.6102 3 12.5256V13.4948C3 14.0471 3.44772 14.4948 4 14.4948H7.58835C7.85498 15.3175 8.31355 16.0556 8.91493 16.6571L7.05279 17.588C5.78875 18.2201 5 19.5062 5 20.9194V22.0027C5 22.555 5.44772 23.0027 6 23.0027H18C18.5523 23.0027 19 22.555 19 22.0027V20.9194C19 19.5062 18.2113 18.2201 16.9472 17.588L15.0851 16.6571C15.6865 16.0556 16.145 15.3175 16.4117 14.4948H20C20.5523 14.4948 21 14.0471 21 13.4948V12.5256C21 10.6102 19.995 8.92672 18.5119 7.94092C18.5222 7.86874 18.5275 7.79498 18.5275 7.72008V4.56573C18.5275 4.16622 18.3037 3.80115 17.948 3.61946L14.7578 2.50123ZM12 16.5C13.933 16.5 15.5 14.933 15.5 13C15.5 11.067 13.933 9.5 12 9.5C10.067 9.5 8.5 11.067 8.5 13C8.5 14.933 10.067 16.5 12 16.5Z" fill="currentColor"/></svg>`,

        AGNT_CRCLM: `<svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 4.5C4 3.11929 5.11929 2 6.5 2H18.5C19.8807 2 21 3.11929 21 4.5V19.5C21 20.8807 19.8807 22 18.5 22H6.5C5.11929 22 4 20.8807 4 19.5V4.5ZM6.5 4C6.22386 4 6 4.22386 6 4.5V19.5C6 19.7761 6.22386 20 6.5 20H18.5C18.7761 20 19 19.7761 19 19.5V4.5C19 4.22386 18.7761 4 18.5 4H6.5ZM8 7C8 6.44772 8.44772 6 9 6H16C16.5523 6 17 6.44772 17 7C17 7.55228 16.5523 8 16 8H9C8.44772 8 8 7.55228 8 7ZM9 10C8.44772 10 8 10.4477 8 11C8 11.5523 8.44772 12 9 12H16C16.5523 12 17 11.5523 17 11C17 10.4477 16.5523 10 16 10H9ZM8 15C8 14.4477 8.44772 14 9 14H13C13.5523 14 14 14.4477 14 15C14 15.5523 13.5523 16 13 16H9C8.44772 16 8 15.5523 8 15Z" fill="currentColor"/></svg>`,

        AGNT_DEVL: `<svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.06065 6.93935C8.45118 6.54883 8.45118 5.91566 8.06065 5.52514C7.67013 5.13461 7.03696 5.13461 6.64644 5.52514L2.64645 9.52513C2.25592 9.91566 2.25592 10.5488 2.64644 10.9394L6.64644 14.9394C7.03696 15.3299 7.67013 15.3299 8.06065 14.9394C8.45118 14.5488 8.45118 13.9157 8.06065 13.5251L4.76776 10.2322L8.06065 6.93935ZM15.9394 5.52514C15.5488 5.13461 14.9157 5.13461 14.5251 5.52514C14.1346 5.91566 14.1346 6.54883 14.5251 6.93935L17.818 10.2322L14.5251 13.5251C14.1346 13.9157 14.1346 14.5488 14.5251 14.9394C14.9157 15.3299 15.5488 15.3299 15.9394 14.9394L19.9394 10.9394C20.3299 10.5488 20.3299 9.91566 19.9394 9.52513L15.9394 5.52514ZM13.3193 3.5532C13.1456 2.9782 12.5438 2.65487 11.9688 2.82856C11.3938 3.00225 11.0705 3.60408 11.2442 4.17905L14.0816 13.5732C14.2553 14.1482 14.8571 14.4715 15.4321 14.2978C16.0071 14.1241 16.3304 13.5223 16.1567 12.9473L13.3193 3.5532Z" fill="currentColor"/></svg>`,

        CLSM: `<svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 5.25C3 4.00736 4.00736 3 5.25 3H18.75C19.9926 3 21 4.00736 21 5.25V18.75C21 19.9926 19.9926 21 18.75 21H5.25C4.00736 21 3 19.9926 3 18.75V5.25ZM5.25 5C5.11193 5 5 5.11193 5 5.25V11H11V5H5.25ZM13 5V11H19V5.25C19 5.11193 18.8881 5 18.75 5H13ZM19 13H13V19H18.75C18.8881 19 19 18.8881 19 18.75V13ZM11 19V13H5V18.75C5 18.8881 5.11193 19 5.25 19H11Z" fill="currentColor"/></svg>`,

        CLSN: `<svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.25879 10H2V8L7.01444 2.3806C7.56462 1.76667 8.45308 1.61587 9.17516 2.01704L10.3679 2.68008C11.1622 3.1216 11.4469 4.12188 11.0111 4.9196L9.42413 7.824C9.34613 7.96667 9.29474 8.12257 9.27266 8.2839L9.25879 8.5V10H14.7512V8.5C14.7512 8.3306 14.7189 8.16269 14.6562 8.00505L12.7389 3.17305C12.4413 2.42383 12.7904 1.57549 13.5213 1.23916L13.6627 1.17774C14.3527 0.87007 15.1614 1.13094 15.5459 1.78313L20 9.33138V10H22V12H20V20.75C20 21.4404 19.4404 22 18.75 22H5.25C4.55964 22 4 21.4404 4 20.75V12H2V10H4.25879ZM6 12V20H18V12H6Z" fill="currentColor"/></svg>`,

        AGNT_SOP: `<svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 2C4.89543 2 4 2.89543 4 4V20C4 21.1046 4.89543 22 6 22H18C19.1046 22 20 21.1046 20 20V8.82843C20 8.29799 19.7893 7.78929 19.4142 7.41421L14.5858 2.58579C14.2107 2.21071 13.702 2 13.1716 2H6ZM6 4H13V8C13 8.55228 13.4477 9 14 9H18V20H6V4ZM15 4.41421L17.5858 7H15V4.41421ZM8 12C8 11.4477 8.44772 11 9 11H15C15.5523 11 16 11.4477 16 12C16 12.5523 15.5523 13 15 13H9C8.44772 13 8 12.5523 8 12ZM9 15C8.44772 15 8 15.4477 8 16C8 16.5523 8.44772 17 9 17H15C15.5523 17 16 16.5523 16 16C16 15.4477 15.5523 15 15 15H9Z" fill="currentColor"/></svg>`,

        AGNT_SALES: `<svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12.0049 2C13.8814 2 15.4333 3.31237 15.8735 5.07801L20.7502 5.07764C21.1644 5.07764 21.5002 5.41343 21.5002 5.82764C21.5002 6.20309 21.2231 6.51427 20.864 6.56856L20.7502 6.57764L20.1212 6.57767L18.3544 19.0039C18.1814 20.2012 17.1515 21.0993 15.9411 21.0993H8.06863C6.85825 21.0993 5.82842 20.2013 5.65537 19.004L3.88713 6.57767L3.25021 6.57764C2.83599 6.57764 2.50021 6.24186 2.50021 5.82764C2.50021 5.4522 2.77736 5.14102 3.13643 5.08672L3.25021 5.07764L8.13574 5.078C8.57592 3.31237 10.1278 2 12.0049 2ZM18.6122 6.57767H5.39567L7.13913 18.8293C7.20329 19.2728 7.57527 19.5993 8.06863 19.5993H15.9411C16.4345 19.5993 16.8065 19.2727 16.8707 18.8292L18.6122 6.57767ZM13.0044 9.25C13.4186 9.25 13.7544 9.58579 13.7544 10V16.5C13.7544 16.9142 13.4186 17.25 13.0044 17.25C12.5902 17.25 12.2544 16.9142 12.2544 16.5V10C12.2544 9.58579 12.5902 9.25 13.0044 9.25ZM10.0044 9.25C10.4186 9.25 10.7544 9.58579 10.7544 10V16.5C10.7544 16.9142 10.4186 17.25 10.0044 17.25C9.5902 17.25 9.2544 16.9142 9.2544 16.5V10C9.2544 9.58579 9.5902 9.25 10.0044 9.25ZM12.0049 3.5C10.9068 3.5 9.97093 4.18052 9.61244 5.07801L14.3968 5.078C14.0383 4.18052 13.1024 3.5 12.0049 3.5Z" fill="currentColor"/></svg>`,

        KNL: `<svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12.0123 2.24856C12.7405 1.91714 13.5852 1.91714 14.3134 2.24856L14.4414 2.3088L20.4414 5.3088C21.4024 5.7893 22.0049 6.7624 22.0049 7.82764V16.1724C22.0049 17.2376 21.4024 18.2107 20.4414 18.6912L14.4414 21.6912C13.6927 22.0656 12.8216 22.0986 12.0536 21.79L11.8843 21.7118L5.5593 18.6912C4.59826 18.2107 3.99585 17.2376 3.99585 16.1724V7.82764C3.99585 6.7624 4.59826 5.7893 5.5593 5.3088L11.5593 2.3088L11.8843 2.17074L12.0123 2.24856ZM13.428 3.99258C13.2265 3.90086 12.9992 3.89173 12.7918 3.96516L12.6777 4.01324L6.38267 7.1273C6.00988 7.31369 5.77834 7.68257 5.74836 8.09185L5.74585 8.20264V15.7974C5.74585 16.242 5.99961 16.6465 6.39752 16.8448L6.50698 16.8886L12.7977 19.9726C12.9853 20.064 13.1968 20.085 13.3959 20.0355L13.507 19.9955L13.6177 19.94L19.618 16.9427C19.9905 16.756 20.2218 16.387 20.2515 15.978L20.2539 15.8674V8.13264C20.2539 7.68805 20.0001 7.28355 19.6022 7.08527L19.4927 7.0415L13.428 3.99258ZM13.1257 8.56476C13.4367 8.26543 13.9327 8.26543 14.2437 8.56476L14.3198 8.64827L16.8198 11.7733C17.062 12.076 17.062 12.504 16.8198 12.8067L14.3198 15.9317C14.0087 16.2987 13.4493 16.3447 13.0822 16.0337C12.749 15.7517 12.6937 15.2673 12.9371 14.9213L13.0106 14.8303L14.859 12.54L12.76 10.0043L12.6839 9.9208C12.3889 9.5898 12.4149 9.0839 12.7617 8.7889L12.8452 8.7128L13.1257 8.56476ZM10.8737 8.56476L10.9572 8.64827L11.2377 8.7889C11.5681 9.0683 11.612 9.5429 11.3739 9.8767L11.2977 9.968L9.14003 12.54L10.9886 14.8303C11.2676 15.1604 11.2467 15.6533 10.9483 15.9587L10.8655 16.0337C10.5354 16.3127 10.0425 16.2918 9.7371 15.9933L9.6621 15.9106L7.17954 12.8067C6.93735 12.504 6.93735 12.076 7.17954 11.7733L9.7558 8.56476C10.0668 8.26543 10.5628 8.26543 10.8737 8.56476Z" fill="currentColor"/></svg>`,

        AGNT_FIN: `<svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.8751 2C17.3248 2 18.5001 3.17525 18.5001 4.625V5.75438C19.6429 6.36521 20.1696 7.14521 20.4499 7.71413L20.5001 7.82001V19.375C20.5001 20.8247 19.3248 22 17.8751 22H6.12508C4.67533 22 3.50008 20.8247 3.50008 19.375V7.82001L3.55039 7.71402C3.83033 7.14576 4.35636 6.366 5.49841 5.75525L5.50008 4.625C5.50008 3.17525 6.67533 2 8.12508 2H15.8751ZM18.5001 9.5H5.50008V19.375C5.50008 19.7202 5.77993 20 6.12508 20H17.8751C18.2202 20 18.5001 19.7202 18.5001 19.375V9.5ZM13.2501 12C13.6643 12 14.0001 12.3358 14.0001 12.75V14H15.2501C15.6643 14 16.0001 14.3358 16.0001 14.75C16.0001 15.1642 15.6643 15.5 15.2501 15.5H14.0001V16.75C14.0001 17.1642 13.6643 17.5 13.2501 17.5C12.8359 17.5 12.5001 17.1642 12.5001 16.75V15.5H11.2501C10.8359 15.5 10.5001 15.1642 10.5001 14.75C10.5001 14.3358 10.8359 14 11.2501 14H12.5001V12.75C12.5001 12.3358 12.8359 12 13.2501 12ZM8.75008 12C9.1643 12 9.50008 12.3358 9.50008 12.75C9.50008 13.1642 9.1643 13.5 8.75008 13.5H8.25008C7.83587 13.5 7.50008 13.1642 7.50008 12.75C7.50008 12.3358 7.83587 12 8.25008 12H8.75008ZM15.8751 4H8.12508C7.77993 4 7.50008 4.27982 7.50008 4.625V5.5H16.5001V4.625C16.5001 4.27982 16.2202 4 15.8751 4Z" fill="currentColor"/></svg>`,

        AGNT_PROC: `<svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 4.25C2.5 3.83579 2.83579 3.5 3.25 3.5H3.79815C4.79656 3.5 5.65488 4.17682 5.88464 5.14854L6.05795 5.875H20.7482C21.3773 5.875 21.8464 6.4635 21.7079 7.07699L20.2079 13.577C20.1079 14.0107 19.7229 14.3179 19.2782 14.3179H7.81398L7.97977 15.027C8.03526 15.2646 8.24753 15.4337 8.49164 15.4337H18.7516C19.1658 15.4337 19.5016 15.7695 19.5016 16.1837C19.5016 16.5979 19.1658 16.9337 18.7516 16.9337H8.49164C7.51932 16.9337 6.67862 16.2456 6.51163 15.2874L4.41685 5.69362C4.35878 5.44512 4.13724 5.26655 3.88111 5.25097L3.79815 5.25L3.25 5.25C2.83579 5.25 2.5 4.9142 2.5 4.5V4.25ZM7.5 20C7.5 19.1716 8.17157 18.5 9 18.5C9.82843 18.5 10.5 19.1716 10.5 20C10.5 20.8284 9.82843 21.5 9 21.5C8.17157 21.5 7.5 20.8284 7.5 20ZM16.5 20C16.5 19.1716 17.1716 18.5 18 18.5C18.8284 18.5 19.5 19.1716 19.5 20C19.5 20.8284 18.8284 21.5 18 21.5C17.1716 21.5 16.5 20.8284 16.5 20Z" fill="currentColor"/></svg>`,

        AGNT_MKT: `<svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18.493 3.09169C18.8061 2.85892 19.2353 2.86493 19.542 3.1062C21.6837 4.79289 23 7.43469 23 10.4C23 13.3653 21.6837 16.0071 19.542 17.6938C19.2353 17.9351 18.8061 17.9411 18.493 17.7083C18.1799 17.4755 18.1008 17.0499 18.3076 16.7204C19.3507 15.0572 20.5 13.0103 20.5 10.4C20.5 7.78971 19.3507 5.74282 18.3076 4.07962C18.1008 3.75011 18.1799 3.32446 18.493 3.09169ZM14.9285 2.03709C15.3696 2.21979 15.6 2.70313 15.4768 3.15403L15.4455 3.24658L12.9686 8.75H14.75C15.1297 8.75 15.4435 9.03215 15.4932 9.39823L15.5 9.5V11.25C15.5 11.6297 15.2178 11.9435 14.8518 11.9932L14.75 12H13.909L12.6725 20.6563C12.608 21.1078 12.2109 21.4301 11.7571 21.3965C11.3034 21.363 10.951 20.9932 10.9444 20.5412L10.951 20.4437L12.118 12H10.25C9.87030 12 9.55651 11.7178 9.50685 11.3518L9.5 11.25V9.5C9.5 9.1203 9.78215 8.80651 10.1482 8.75685L10.25 8.75H11.7802L14.0545 2.95342C14.226 2.51615 14.6926 2.28087 15.1387 2.41117L14.9285 2.03709ZM3.75 7.25C4.16421 7.25 4.5 7.58579 4.5 8V12.8C4.5 13.2142 4.16421 13.55 3.75 13.55C3.33579 13.55 3 13.2142 3 12.8V8C3 7.58579 3.33579 7.25 3.75 7.25ZM7.25 5.5C7.66421 5.5 8 5.83579 8 6.25V14.55C8 14.9642 7.66421 15.3 7.25 15.3C6.83579 15.3 6.5 14.9642 6.5 14.55V6.25C6.5 5.83579 6.83579 5.5 7.25 5.5Z" fill="currentColor"/></svg>`
    };

    // Fallback icon — generic grid/app icon
    const DEFAULT_ICON = `<svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 5.25C3 4.00736 4.00736 3 5.25 3H8.75C9.99264 3 11 4.00736 11 5.25V8.75C11 9.99264 9.99264 11 8.75 11H5.25C4.00736 11 3 9.99264 3 8.75V5.25ZM5.25 5C5.11193 5 5 5.11193 5 5.25V8.75C5 8.88807 5.11193 9 5.25 9H8.75C8.88807 9 9 8.88807 9 8.75V5.25C9 5.11193 8.88807 5 8.75 5H5.25ZM13 5.25C13 4.00736 14.0074 3 15.25 3H18.75C19.9926 3 21 4.00736 21 5.25V8.75C21 9.99264 19.9926 11 18.75 11H15.25C14.0074 11 13 9.99264 13 8.75V5.25ZM15.25 5C15.1119 5 15 5.11193 15 5.25V8.75C15 8.88807 15.1119 9 15.25 9H18.75C18.8881 9 19 8.88807 19 8.75V5.25C19 5.11193 18.8881 5 18.75 5H15.25ZM3 15.25C3 14.0074 4.00736 13 5.25 13H8.75C9.99264 13 11 14.0074 11 15.25V18.75C11 19.9926 9.99264 21 8.75 21H5.25C4.00736 21 3 19.9926 3 18.75V15.25ZM5.25 15C5.11193 15 5 15.1119 5 15.25V18.75C5 18.8881 5.11193 19 5.25 19H8.75C8.88807 19 9 18.8881 9 18.75V15.25C9 15.1119 8.88807 15 8.75 15H5.25ZM13 15.25C13 14.0074 14.0074 13 15.25 13H18.75C19.9926 13 21 14.0074 21 15.25V18.75C21 19.9926 19.9926 21 18.75 21H15.25C14.0074 21 13 19.9926 13 18.75V15.25ZM15.25 15C15.1119 15 15 15.1119 15 15.25V18.75C15 18.8881 15.1119 19 15.25 19H18.75C18.8881 19 19 18.8881 19 18.75V15.25C19 15.1119 18.8881 15 18.75 15H15.25Z" fill="currentColor"/></svg>`;

    function render() {
        document.getElementById('login-page').classList.add('d-none');
        document.getElementById('app-layout').classList.remove('d-none');
        Components.hideSidebar();
        Components.renderNavbar('ecc');

        const allModules = Store.getAll('solutions_modules');
        const filtered = activeFilter === 'all'
            ? allModules
            : allModules.filter(m => m.solution_code === activeFilter);

        const center = document.getElementById('center-stage');
        center.className = 'center-stage ecc-page';

        center.innerHTML = `
            <div class="ecc-main">
                <div class="ecc-header">
                    <h1>Welcome to Enterprise Control Centre</h1>
                    <p>Centralized role-based management for <strong>CLaaS<span class="gold">2</span>SaaS</strong></p>
                </div>

                <div class="ecc-modules-grid" id="ecc-modules-grid">
                    ${renderModuleCards(filtered)}
                </div>
            </div>
        `;
    }

    function renderModuleCards(modules) {
        return modules.map(m => {
            const isKernel = m.module_code === 'KNL';
            const icon = MODULE_ICONS[m.module_code] || DEFAULT_ICON;
            return `
                <div class="ecc-module-card ${isKernel ? 'kernel-card' : ''}" onclick="${isKernel ? "Router.navigate('kernel-dashboard')" : 'void(0)'}">
                    <div class="module-card-icon">
                        ${icon}
                    </div>
                    <div class="module-card-name">${m.module_name}</div>
                    ${isKernel ? '<span class="module-card-badge">Open</span>' : '<span class="module-card-badge locked"><i class="fas fa-lock"></i></span>'}
                </div>
            `;
        }).join('');
    }

    function filter(code) {
        activeFilter = code;
        render();
    }

    function search(query) {
        const allModules = Store.getAll('solutions_modules');
        const q = query.toLowerCase();
        const filtered = allModules.filter(m =>
            m.module_name.toLowerCase().includes(q) ||
            m.solution_name.toLowerCase().includes(q) ||
            m.module_code.toLowerCase().includes(q)
        );
        document.getElementById('ecc-modules-grid').innerHTML = renderModuleCards(filtered);
    }

    return { render, filter, search };
})();
